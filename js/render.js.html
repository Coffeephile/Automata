<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>~/Automata/Automata/js/render.js.html</title>
<meta name="Generator" content="Vim/7.2">
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
</head>
<body bgcolor="#242424" text="#f6f3e8"><font face="monospace">
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;1 </font></span><font color="#cae682"><b>function</b></font>&nbsp;Renderer(&nbsp;canvas, dfaview )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;2 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;<font color="#8ac6f2"><b>self</b></font>&nbsp;= <font color="#cae682"><b>this</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;3 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;4 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.canvas = canvas;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;5 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.ctx = <font color="#cae682"><b>this</b></font>.canvas.getContext(&nbsp;<font color="#95e454"><i>'2d'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;6 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.dfaview = dfaview;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;7 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.mouseOverElement = <font color="#cae682"><b>[]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;8 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.offset = <font color="#8ac6f2">new</font>&nbsp;Vector(&nbsp;canvas.offsetLeft, canvas.offsetTop );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;&nbsp;9 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;10 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;mouseOut(&nbsp;element, e )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;11 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;<font color="#95e454"><i>'mouseout'</i></font>&nbsp;+ element<font color="#cae682"><b>[</b></font>&nbsp;0&nbsp;<font color="#cae682"><b>]</b></font>, element<font color="#cae682"><b>[</b></font>&nbsp;1&nbsp;<font color="#cae682"><b>]</b></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;12 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;13 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;mouseOver(&nbsp;element, e )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;14 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;<font color="#95e454"><i>'mouseover'</i></font>&nbsp;+ element<font color="#cae682"><b>[</b></font>&nbsp;0&nbsp;<font color="#cae682"><b>]</b></font>, element<font color="#cae682"><b>[</b></font>&nbsp;1&nbsp;<font color="#cae682"><b>]</b></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;15 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;16 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;mouseMove(&nbsp;element, e )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;17 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;<font color="#95e454"><i>'mousemove'</i></font>&nbsp;+ element<font color="#cae682"><b>[</b></font>&nbsp;0&nbsp;<font color="#cae682"><b>]</b></font>, element<font color="#cae682"><b>[</b></font>&nbsp;1&nbsp;<font color="#cae682"><b>]</b></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;18 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;19 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;propagateEvent(&nbsp;evt )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;20 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;canvas.addEventListener(&nbsp;evt, <font color="#cae682"><b>function</b></font>(&nbsp;e )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;21 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;handleMouseMotion.call(&nbsp;<font color="#cae682"><b>this</b></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;22 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;23 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement != <font color="#e5786d"><b>false</b></font>&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;24 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;evt + <font color="#8ac6f2"><b>self</b></font>.mouseOverElement<font color="#cae682"><b>[</b></font>&nbsp;0&nbsp;<font color="#cae682"><b>]</b></font>, <font color="#8ac6f2"><b>self</b></font>.mouseOverElement<font color="#cae682"><b>[</b></font>&nbsp;1&nbsp;<font color="#cae682"><b>]</b></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;25 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;26 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">else</font>&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;27 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;evt + <font color="#95e454"><i>'void'</i></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;28 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;29 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;evt, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;30 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;31 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;32 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;propagateEvent(&nbsp;<font color="#95e454"><i>'mousedown'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;33 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;propagateEvent(&nbsp;<font color="#95e454"><i>'mouseup'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;34 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;propagateEvent(&nbsp;<font color="#95e454"><i>'click'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;35 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;propagateEvent(&nbsp;<font color="#95e454"><i>'dblclick'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;36 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;37 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;handleMouseMotion(&nbsp;e )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;38 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;x = e.clientX - <font color="#8ac6f2"><b>self</b></font>.offset.x;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;39 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;y = e.clientY - <font color="#8ac6f2"><b>self</b></font>.offset.y;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;40 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;41 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test = <font color="#8ac6f2"><b>self</b></font>.hitTest(&nbsp;<font color="#8ac6f2">new</font>&nbsp;Vector(&nbsp;x, y )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;42 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;!same(&nbsp;test, <font color="#8ac6f2"><b>self</b></font>.mouseOverElement )&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;43 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement !== <font color="#e5786d"><b>false</b></font>&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;44 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mouseOut(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;45 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;46 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;test !== <font color="#e5786d"><b>false</b></font>&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;47 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mouseOver(&nbsp;test, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;48 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;49 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;50 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;test !== <font color="#e5786d"><b>false</b></font>&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;51 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mouseMove(&nbsp;test, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;52 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;53 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement = test;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;54 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.emit(&nbsp;<font color="#95e454"><i>'mousemove'</i></font>, e );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;55 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;56 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;dfaview.dfa.on(&nbsp;<font color="#95e454"><i>'beforestatedeleted'</i></font>, <font color="#cae682"><b>function</b></font>(&nbsp;state )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;57 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement<font color="#cae682"><b>[</b></font>&nbsp;0&nbsp;<font color="#cae682"><b>]</b></font>&nbsp;== <font color="#95e454"><i>'state'</i></font>&nbsp;)&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;58 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement<font color="#cae682"><b>[</b></font>&nbsp;1&nbsp;<font color="#cae682"><b>]</b></font>&nbsp;== state )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;59 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mouseOut(&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement, <font color="#e5786d"><b>false</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;60 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2"><b>self</b></font>.mouseOverElement = <font color="#e5786d"><b>false</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;61 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;62 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;63 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;64 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;65 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;canvas.addEventListener(&nbsp;<font color="#95e454"><i>'mousemove'</i></font>, handleMouseMotion );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;66 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;67 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;EventEmitter.call(&nbsp;<font color="#cae682"><b>this</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;68 </font></span><font color="#cae682"><b>}</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;69 </font></span>Renderer.prototype = <font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;70 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;STATE_RADIUS: 25,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;71 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;ARROW_RADIUS: 15,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;72 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;ARROW_ANGLE: Math.PI / 6,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;73 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;SELF_TRANSITION_RADIUS: 20,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;74 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;constructor: Renderer,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;75 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;render: <font color="#cae682"><b>function</b></font>()&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;76 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.ctx.clearRect(&nbsp;0, 0, 800, 800&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;77 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;dfa = <font color="#cae682"><b>this</b></font>.dfaview.dfa;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;78 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;alphabetsize = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;79 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;stateArray = <font color="#cae682"><b>[]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;80 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;81 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;sigma <font color="#8ac6f2">in</font>&nbsp;dfa.alphabet )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;82 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++alphabetsize;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;83 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;84 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;state <font color="#8ac6f2">in</font>&nbsp;dfa.states )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;85 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;j = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;86 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stateArray.push(&nbsp;<font color="#cae682"><b>this</b></font>.dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;state <font color="#cae682"><b>]</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;87 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;88 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stateArray.sort(&nbsp;<font color="#cae682"><b>function</b></font>&nbsp;(&nbsp;x, y )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;89 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;x.zindex - y.zindex;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;90 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;91 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;i = 0; i &lt; dfa.numStates; ++i )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;92 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;state = stateArray<font color="#cae682"><b>[</b></font>&nbsp;i <font color="#cae682"><b>]</b></font>.state;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;93 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;sigma <font color="#8ac6f2">in</font>&nbsp;dfa.alphabet )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;94 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderTransition(&nbsp;state, sigma, dfa.transitions<font color="#cae682"><b>[</b></font>&nbsp;state <font color="#cae682"><b>][</b></font>&nbsp;sigma <font color="#cae682"><b>]</b></font>, j / alphabetsize );<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;95 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++j;<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;96 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;97 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderState(<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;98 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;state, stateArray<font color="#cae682"><b>[</b></font>&nbsp;i <font color="#cae682"><b>]</b></font>.position,<br>
<span style="background-color: #000000"><font color="#857b6f">&nbsp;99 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;stateArray<font color="#cae682"><b>[</b></font>&nbsp;i <font color="#cae682"><b>]</b></font>.importance,<br>
<span style="background-color: #000000"><font color="#857b6f">100 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dfa.accept<font color="#cae682"><b>[</b></font>&nbsp;stateArray<font color="#cae682"><b>[</b></font>&nbsp;i <font color="#cae682"><b>]</b></font>.state <font color="#cae682"><b>]</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">101 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">102 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">103 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">104 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;renderState: <font color="#cae682"><b>function</b></font>(&nbsp;state, position, importance, accepting )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">105 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;ctx = <font color="#cae682"><b>this</b></font>.ctx;<br>
<span style="background-color: #000000"><font color="#857b6f">106 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;radgrad = ctx.createRadialGradient(&nbsp;0, 0, 0, 0, 0, <font color="#cae682"><b>this</b></font>.STATE_RADIUS );<br>
<span style="background-color: #000000"><font color="#857b6f">107 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">108 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">109 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radgrad.addColorStop(&nbsp;0, <font color="#95e454"><i>'#fff'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">110 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radgrad.addColorStop(&nbsp;0.8, <font color="#95e454"><i>'#e8ecf0'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">111 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;radgrad.addColorStop(&nbsp;1, <font color="#95e454"><i>'#fff'</i></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">112 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.strokeStyle = <font color="#95e454"><i>'black'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">113 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineWidth = 2;<br>
<span style="background-color: #000000"><font color="#857b6f">114 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowColor = <font color="#95e454"><i>'rgba( 0, 0, 0, 0.3 )'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">115 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowOffsetX = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">116 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowOffsetY = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">117 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowBlur = 5;<br>
<span style="background-color: #000000"><font color="#857b6f">118 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">switch</font>&nbsp;(&nbsp;importance )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">119 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'normal'</i></font>:<br>
<span style="background-color: #000000"><font color="#857b6f">120 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">121 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'strong'</i></font>:<br>
<span style="background-color: #000000"><font color="#857b6f">122 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowColor = <font color="#95e454"><i>'#7985b1'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">123 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineWidth = 5;<br>
<span style="background-color: #000000"><font color="#857b6f">124 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.strokeStyle = <font color="#95e454"><i>'#3297fd'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">125 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">126 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'emphasis'</i></font>:<br>
<span style="background-color: #000000"><font color="#857b6f">127 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowColor = <font color="#95e454"><i>'#7985b1'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">128 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowBlur = 15;<br>
<span style="background-color: #000000"><font color="#857b6f">129 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">130 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">131 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">132 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// </i></font><span style="background-color: #ffff00"><font color="#8f8f8f"><i>TODO</i></font></span><font color="#99968b"><i>: Display state name</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">133 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.translate(&nbsp;position.x, position.y );<br>
<span style="background-color: #000000"><font color="#857b6f">134 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.beginPath();<br>
<span style="background-color: #000000"><font color="#857b6f">135 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.arc(&nbsp;0, 0, <font color="#cae682"><b>this</b></font>.STATE_RADIUS, 0, 2&nbsp;* Math.PI, <font color="#e5786d"><b>true</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">136 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.stroke();<br>
<span style="background-color: #000000"><font color="#857b6f">137 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fillStyle = radgrad;<br>
<span style="background-color: #000000"><font color="#857b6f">138 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fill();<br>
<span style="background-color: #000000"><font color="#857b6f">139 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">140 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">141 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;renderArrow: <font color="#cae682"><b>function</b></font>(&nbsp;from, to )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">142 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;ctx = <font color="#cae682"><b>this</b></font>.ctx;<br>
<span style="background-color: #000000"><font color="#857b6f">143 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;theta = Math.atan2(&nbsp;to.y - from.y, to.x - from.x );<br>
<span style="background-color: #000000"><font color="#857b6f">144 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">145 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.beginPath();<br>
<span style="background-color: #000000"><font color="#857b6f">146 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// draw arrow line</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">147 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.moveTo(&nbsp;from.x, from.y );<br>
<span style="background-color: #000000"><font color="#857b6f">148 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">149 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.translate(&nbsp;to.x, to.y );<br>
<span style="background-color: #000000"><font color="#857b6f">150 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.rotate(&nbsp;theta );<br>
<span style="background-color: #000000"><font color="#857b6f">151 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">152 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineTo(&nbsp;0, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">153 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.stroke();<br>
<span style="background-color: #000000"><font color="#857b6f">154 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">155 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderArrowEnd();<br>
<span style="background-color: #000000"><font color="#857b6f">156 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">157 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">158 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">159 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">160 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;renderArrowEnd: <font color="#cae682"><b>function</b></font>()&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">161 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;ctx = <font color="#cae682"><b>this</b></font>.ctx;<br>
<span style="background-color: #000000"><font color="#857b6f">162 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span style="background-color: #000000"><font color="#857b6f">163 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">164 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.beginPath();<br>
<span style="background-color: #000000"><font color="#857b6f">165 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.rotate(&nbsp;<font color="#cae682"><b>this</b></font>.ARROW_ANGLE );<br>
<span style="background-color: #000000"><font color="#857b6f">166 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.translate(&nbsp;-<font color="#cae682"><b>this</b></font>.ARROW_RADIUS, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">167 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.moveTo(&nbsp;0, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">168 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">169 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineTo(&nbsp;0, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">170 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">171 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.rotate(&nbsp;-<font color="#cae682"><b>this</b></font>.ARROW_ANGLE );<br>
<span style="background-color: #000000"><font color="#857b6f">172 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.translate(&nbsp;-<font color="#cae682"><b>this</b></font>.ARROW_RADIUS, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">173 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineTo(&nbsp;0, 0&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">174 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">175 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">176 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.rotate(&nbsp;Math.PI / 2&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">177 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fill();<br>
<span style="background-color: #000000"><font color="#857b6f">178 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.closePath();<br>
<span style="background-color: #000000"><font color="#857b6f">179 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">180 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">181 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;renderText: <font color="#cae682"><b>function</b></font>(&nbsp;<font color="#8ac6f2"><b>location</b></font>, text )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">182 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;ctx = <font color="#cae682"><b>this</b></font>.ctx;<br>
<span style="background-color: #000000"><font color="#857b6f">183 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;dim = ctx.measureText(&nbsp;text );<br>
<span style="background-color: #000000"><font color="#857b6f">184 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">185 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">186 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fillStyle = <font color="#95e454"><i>'black'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">187 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.font = <font color="#95e454"><i>'12pt Verdana'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">188 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.strokeStyle = <font color="#95e454"><i>'white'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">189 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.lineWidth = 6;<br>
<span style="background-color: #000000"><font color="#857b6f">190 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.strokeText(&nbsp;text, <font color="#8ac6f2"><b>location</b></font>.x - dim.width, <font color="#8ac6f2"><b>location</b></font>.y + dim.width / 2&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">191 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fillText(&nbsp;text, <font color="#8ac6f2"><b>location</b></font>.x - dim.width, <font color="#8ac6f2"><b>location</b></font>.y + dim.width / 2&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">192 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">193 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">194 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;renderTransition: <font color="#cae682"><b>function</b></font>(&nbsp;from, via, to, angle )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">195 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;strokeStyle = <font color="#95e454"><i>'black'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">196 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;ctx = <font color="#cae682"><b>this</b></font>.ctx;<br>
<span style="background-color: #000000"><font color="#857b6f">197 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;transitionView = <font color="#cae682"><b>this</b></font>.dfaview.transitions<font color="#cae682"><b>[</b></font>&nbsp;from <font color="#cae682"><b>][</b></font>&nbsp;via <font color="#cae682"><b>]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">198 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;start, end, target;<br>
<span style="background-color: #000000"><font color="#857b6f">199 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;circular = <font color="#e5786d"><b>false</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">200 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">201 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">202 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fillStyle = ctx.strokeStyle = <font color="#95e454"><i>'black'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">203 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">switch</font>&nbsp;(&nbsp;transitionView.importance )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">204 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'normal'</i></font>:<br>
<span style="background-color: #000000"><font color="#857b6f">205 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">206 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'strong'</i></font>: <font color="#99968b"><i>// used for selection in the editor</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">207 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.fillStyle = ctx.strokeStyle = <font color="#95e454"><i>'#3297fd'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">208 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">209 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">case</font>&nbsp;<font color="#95e454"><i>'emphasis'</i></font>: <font color="#99968b"><i>// used for mouseover in the editor</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">210 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowColor = <font color="#95e454"><i>'#7985b1'</i></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">211 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.shadowBlur = 15;<br>
<span style="background-color: #000000"><font color="#857b6f">212 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// ctx.strokeStyle = 'red';</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">213 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">break</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">214 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">215 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">216 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;from = <font color="#cae682"><b>this</b></font>.dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;from <font color="#cae682"><b>]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">217 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;transitionView.detached )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">218 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target = transitionView.position;<br>
<span style="background-color: #000000"><font color="#857b6f">219 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">220 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">else</font>&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">221 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to = <font color="#cae682"><b>this</b></font>.dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;to <font color="#cae682"><b>]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">222 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;target = to.position;<br>
<span style="background-color: #000000"><font color="#857b6f">223 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;circular = to.state == from.state;<br>
<span style="background-color: #000000"><font color="#857b6f">224 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">225 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;circular )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">226 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// </i></font><span style="background-color: #ffff00"><font color="#8f8f8f"><i>TODO</i></font></span><font color="#99968b"><i>: devise a deterministic algorithm for aligning transitions</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">227 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// so that they do not overlap</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">228 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle *= 2&nbsp;* Math.PI;<br>
<span style="background-color: #000000"><font color="#857b6f">229 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">230 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">else</font>&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">231 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle = from.position.minus(&nbsp;target ).theta();<br>
<span style="background-color: #000000"><font color="#857b6f">232 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">233 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;offset = Vector.fromPolar(&nbsp;<font color="#cae682"><b>this</b></font>.STATE_RADIUS, angle );<br>
<span style="background-color: #000000"><font color="#857b6f">234 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;start = from.position.minus(&nbsp;offset );<br>
<span style="background-color: #000000"><font color="#857b6f">235 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;circular )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">236 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;center = start.minus(&nbsp;Vector.fromPolar(&nbsp;(&nbsp;1&nbsp;/ 2&nbsp;)&nbsp;* <font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS, angle )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">237 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.beginPath();<br>
<span style="background-color: #000000"><font color="#857b6f">238 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.arc(&nbsp;center.x, center.y, <font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS, 0, 2&nbsp;* Math.PI, <font color="#e5786d"><b>false</b></font>&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">239 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.stroke();<br>
<span style="background-color: #000000"><font color="#857b6f">240 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>/*</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">241 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * We need to determine the two points of intersection of the two circles</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">242 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * The state circle and the self-transition circle, so as to draw the arrow</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">243 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * head for the self-transition. We'll draw it to point to one of the two</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">244 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * intersection points at the correct angle.</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">245 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">246 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * We're looking for a solution to the system of equations:</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">247 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * r1^2 = h^2 + d1^2</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">248 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * r2^2 = h^2 + d2^2</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">249 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * d1 + d2 = D</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">250 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * solving for unknowns h, d1, d2 and known r1, r2, D</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">251 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; * where r1 is the radius of the self-transition</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">252 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; r2 is the radius of the state</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">253 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; D is the distance between the state center and self-transition center</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">254 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; d1 is the distance from the self-transition center to</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">255 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; the middle between the two points of intersection of the two circles</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">256 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; on the line that connect them</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">257 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; and +-h gives the high of the point at a distance perpendicular</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">258 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; to the line that connects the two centers</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">259 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; *&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; <a href="http://www.wolframalpha.com/input/?i=solve+for+d1%2C+d2%2C+h%3A+%7B+r1%5E2+%3D+h%5E2+%2B+d1%5E2%2C+r2%5E2+%3D+h%5E2+%2B+d2%5E2%2C+d1+%2B+d2+%3D+D+%7D">http://www.wolframalpha.com/input/?i=solve+for+d1%2C+d2%2C+h%3A+%7B+r1%5E2+%3D+h%5E2+%2B+d1%5E2%2C+r2%5E2+%3D+h%5E2+%2B+d2%5E2%2C+d1+%2B+d2+%3D+D+%7D</a></i></font><br>
<span style="background-color: #000000"><font color="#857b6f">260 </font></span><font color="#99968b"><i>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; */</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">261 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d = from.position.minus(&nbsp;center );<br>
<span style="background-color: #000000"><font color="#857b6f">262 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;D = d.length();<br>
<span style="background-color: #000000"><font color="#857b6f">263 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;r1 = <font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">264 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;r2 = <font color="#cae682"><b>this</b></font>.STATE_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">265 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d2 = (&nbsp;D * D - r1 * r1 + r2 * r2 )&nbsp;/ (&nbsp;2&nbsp;* D );<br>
<span style="background-color: #000000"><font color="#857b6f">266 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d1 = (&nbsp;D * D - r2 * r2 + r1 * r1 )&nbsp;/ (&nbsp;2&nbsp;* D );<br>
<span style="background-color: #000000"><font color="#857b6f">267 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;k = D * D + r1 * r1 - r2 * r2;<br>
<span style="background-color: #000000"><font color="#857b6f">268 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;h = Math.sqrt(&nbsp;r1 * r1 - k * k / (&nbsp;4&nbsp;* D * D )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">269 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;intersect = center.plus(&nbsp;Vector.fromPolar(&nbsp;d1, angle )&nbsp;).plus(&nbsp;Vector.fromPolar(&nbsp;h, angle ).rotate(&nbsp;Math.PI / 2&nbsp;)&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">270 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">271 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// the arrowtheta is evaluated at the intersection point</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">272 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// we need to subtract a small amount (Math.PI / 10) to make</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">273 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// it tangent at the point of the center of the arrow head, not at the point</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">274 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// where the arrow points to</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">275 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;arrowtheta = intersect.minus(&nbsp;center ).theta()&nbsp;- Math.PI / 8;<br>
<span style="background-color: #000000"><font color="#857b6f">276 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">277 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.save();<br>
<span style="background-color: #000000"><font color="#857b6f">278 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.translate(&nbsp;intersect.x, intersect.y );<br>
<span style="background-color: #000000"><font color="#857b6f">279 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.rotate(&nbsp;-arrowtheta );<br>
<span style="background-color: #000000"><font color="#857b6f">280 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderArrowEnd();<br>
<span style="background-color: #000000"><font color="#857b6f">281 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">282 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">283 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderText(<br>
<span style="background-color: #000000"><font color="#857b6f">284 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;center.minus(&nbsp;Vector.fromPolar(&nbsp;<font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS, angle )&nbsp;),<br>
<span style="background-color: #000000"><font color="#857b6f">285 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;via<br>
<span style="background-color: #000000"><font color="#857b6f">286 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">287 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">288 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>;<br>
<span style="background-color: #000000"><font color="#857b6f">289 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">290 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end = target;<br>
<span style="background-color: #000000"><font color="#857b6f">291 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;!transitionView.detached )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">292 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;end = end.plus(&nbsp;Vector.fromPolar(&nbsp;<font color="#cae682"><b>this</b></font>.STATE_RADIUS, angle )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">293 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">294 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderArrow(&nbsp;start, end );<br>
<span style="background-color: #000000"><font color="#857b6f">295 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>this</b></font>.renderText(&nbsp;start.plus(&nbsp;end ).scale(&nbsp;1&nbsp;/ 2&nbsp;), via );<br>
<span style="background-color: #000000"><font color="#857b6f">296 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br>
<span style="background-color: #000000"><font color="#857b6f">297 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ctx.restore();<br>
<span style="background-color: #000000"><font color="#857b6f">298 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">299 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;hitTest: <font color="#cae682"><b>function</b></font>(&nbsp;mouse )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">300 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#99968b"><i>// check if the user is hovering a state</i></font><br>
<span style="background-color: #000000"><font color="#857b6f">301 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;dfaview = <font color="#cae682"><b>this</b></font>.dfaview;<br>
<span style="background-color: #000000"><font color="#857b6f">302 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;dfa = dfaview.dfa;<br>
<span style="background-color: #000000"><font color="#857b6f">303 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;test = <font color="#e5786d"><b>false</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">304 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;alphabetsize = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">305 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">306 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;sigma <font color="#8ac6f2">in</font>&nbsp;dfa.alphabet )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">307 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++alphabetsize;<br>
<span style="background-color: #000000"><font color="#857b6f">308 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">309 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;state <font color="#8ac6f2">in</font>&nbsp;<font color="#cae682"><b>this</b></font>.dfaview.states )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">310 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test = <font color="#cae682"><b>this</b></font>.hitTestState(&nbsp;mouse, state, dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;state <font color="#cae682"><b>]</b></font>.position );<br>
<span style="background-color: #000000"><font color="#857b6f">311 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;test )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">312 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;<font color="#cae682"><b>[</b></font>&nbsp;<font color="#95e454"><i>'state'</i></font>, state <font color="#cae682"><b>]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">313 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">314 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">315 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;state <font color="#8ac6f2">in</font>&nbsp;<font color="#cae682"><b>this</b></font>.dfaview.states )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">316 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;j = 0;<br>
<span style="background-color: #000000"><font color="#857b6f">317 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">for</font>&nbsp;(&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;sigma <font color="#8ac6f2">in</font>&nbsp;dfa.alphabet )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">318 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;test = <font color="#cae682"><b>this</b></font>.hitTestTransition(<br>
<span style="background-color: #000000"><font color="#857b6f">319 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;mouse,<br>
<span style="background-color: #000000"><font color="#857b6f">320 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;state <font color="#cae682"><b>]</b></font>.position,<br>
<span style="background-color: #000000"><font color="#857b6f">321 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;sigma,<br>
<span style="background-color: #000000"><font color="#857b6f">322 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;dfaview.states<font color="#cae682"><b>[</b></font>&nbsp;dfa.transitions<font color="#cae682"><b>[</b></font>&nbsp;state <font color="#cae682"><b>][</b></font>&nbsp;sigma <font color="#cae682"><b>]</b></font>&nbsp;<font color="#cae682"><b>]</b></font>.position,<br>
<span style="background-color: #000000"><font color="#857b6f">323 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;j / alphabetsize<br>
<span style="background-color: #000000"><font color="#857b6f">324 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">325 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;test )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">326 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;<font color="#cae682"><b>[</b></font>&nbsp;<font color="#95e454"><i>'transition'</i></font>, <font color="#cae682"><b>[</b></font>&nbsp;state, sigma <font color="#cae682"><b>]</b></font>&nbsp;<font color="#cae682"><b>]</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">327 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">328 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;++j;<br>
<span style="background-color: #000000"><font color="#857b6f">329 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">330 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">331 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;<font color="#e5786d"><b>false</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">332 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">333 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;hitTestState: <font color="#cae682"><b>function</b></font>(&nbsp;mouse, state, position )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">334 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d = mouse.minus(&nbsp;position );<br>
<span style="background-color: #000000"><font color="#857b6f">335 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">336 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;d.length()&nbsp;&lt; <font color="#cae682"><b>this</b></font>.STATE_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">337 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font>,<br>
<span style="background-color: #000000"><font color="#857b6f">338 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;hitTestTransition: <font color="#cae682"><b>function</b></font>(&nbsp;mouse, from, via, to, angle )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">339 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;arrowhead;<br>
<span style="background-color: #000000"><font color="#857b6f">340 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">341 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">if</font>&nbsp;(&nbsp;from == to )&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">342 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;angle *= 2&nbsp;* Math.PI;<br>
<span style="background-color: #000000"><font color="#857b6f">343 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;offset = Vector.fromPolar(&nbsp;<font color="#cae682"><b>this</b></font>.STATE_RADIUS, angle );<br>
<span style="background-color: #000000"><font color="#857b6f">344 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;start = from.minus(&nbsp;offset );<br>
<span style="background-color: #000000"><font color="#857b6f">345 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;center = start.minus(&nbsp;Vector.fromPolar(&nbsp;(&nbsp;1&nbsp;/ 2&nbsp;)&nbsp;* <font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS, angle )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">346 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d = from.minus(&nbsp;center );<br>
<span style="background-color: #000000"><font color="#857b6f">347 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;D = d.length();<br>
<span style="background-color: #000000"><font color="#857b6f">348 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;r1 = <font color="#cae682"><b>this</b></font>.SELF_TRANSITION_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">349 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;r2 = <font color="#cae682"><b>this</b></font>.STATE_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">350 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d2 = (&nbsp;D * D - r1 * r1 + r2 * r2 )&nbsp;/ (&nbsp;2&nbsp;* D );<br>
<span style="background-color: #000000"><font color="#857b6f">351 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d1 = (&nbsp;D * D - r2 * r2 + r1 * r1 )&nbsp;/ (&nbsp;2&nbsp;* D );<br>
<span style="background-color: #000000"><font color="#857b6f">352 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;k = D * D + r1 * r1 - r2 * r2;<br>
<span style="background-color: #000000"><font color="#857b6f">353 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;h = Math.sqrt(&nbsp;r1 * r1 - k * k / (&nbsp;4&nbsp;* D * D )&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">354 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;intersect = center.plus(&nbsp;Vector.fromPolar(&nbsp;d1, angle )&nbsp;).plus(&nbsp;Vector.fromPolar(&nbsp;h, angle ).rotate(&nbsp;Math.PI / 2&nbsp;)&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">355 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrowhead = intersect;<br>
<span style="background-color: #000000"><font color="#857b6f">356 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">357 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">else</font>&nbsp;<font color="#cae682"><b>{</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">358 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;arrowhead = to.minus(<br>
<span style="background-color: #000000"><font color="#857b6f">359 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Vector.fromPolar(&nbsp;<font color="#cae682"><b>this</b></font>.STATE_RADIUS, to.minus(&nbsp;from ).theta()&nbsp;)<br>
<span style="background-color: #000000"><font color="#857b6f">360 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;);<br>
<span style="background-color: #000000"><font color="#857b6f">361 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">362 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>var</b></font>&nbsp;d = arrowhead.minus(&nbsp;mouse );<br>
<span style="background-color: #000000"><font color="#857b6f">363 </font></span><br>
<span style="background-color: #000000"><font color="#857b6f">364 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<font color="#8ac6f2">return</font>&nbsp;d.length()&nbsp;&lt; <font color="#cae682"><b>this</b></font>.ARROW_RADIUS;<br>
<span style="background-color: #000000"><font color="#857b6f">365 </font></span>&nbsp;&nbsp;&nbsp;&nbsp;<font color="#cae682"><b>}</b></font><br>
<span style="background-color: #000000"><font color="#857b6f">366 </font></span><font color="#cae682"><b>}</b></font>;<br>
<span style="background-color: #000000"><font color="#857b6f">367 </font></span>Renderer.extend(&nbsp;EventEmitter );<br>
</font></body>
</html>
